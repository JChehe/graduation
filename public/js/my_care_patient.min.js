var patientInfoDialog=$("#patient_info_dialog");$("table tbody").on("click",".view_info",function(b){var a=$(this).closest("tr");$.ajax({url:"/get_patient_info/"+a.data("uid")}).done(function(h){console.log(h);var d=h.data.patient;var j=d.role_prop;patientInfoDialog.find(".modal-title").text(j.real_name+"的信息").end().find(".account").text(d.account).end().find(".role").text(d.role).end().find(".name").text(j.real_name).end().find(".sex").text(j.sex=="0"?"男":"女").end().find(".age").text(j.age).end().find(".height").text(j.height).end().find(".weight").text(j.weight).end().find(".medical_case").text(j.medical_case).end().find(".id_card").text(j.id_card).end().find(".patient_number").text(5).end().find(".phone").text(j.phone).end().find(".tel_phone").text(j.tel_phone).end().find(".address").text(j.address);var g=h.data.familyList;patientInfoDialog.find(".family_table tbody").empty();for(var f=0,c=g.length;f<c;f++){var e=g[f];$("<tr>"+"<td>"+e.name+"</td>"+"<td>"+e.tel_phone+"</td>"+"<td>"+e.relationship+"</td>"+"<td>"+e.remark+"</td>"+"</tr>").appendTo(patientInfoDialog.find(".family_table tbody"))}$("#patient_info_dialog").modal("show")}).fail(function(){console.log("获取病人信息失败")})});var calendar=$("#calendar");$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},defaultDate:Date.now(),buttonIcons:false,weekNumbers:true,editable:true,eventLimit:true,events:[{title:"按紧急按钮",start:"2015-02-01T16:30:00"}],eventClick:function(c,b,a){b.preventDefault();$.get(c.url,function(h){console.log(h);var g="";for(var f=0,d=h.length;f<d;f++){var e=h[f];g+="<tr>"+"<td>"+e.create_time+"</td>"+"<td>"+e.doctor_name+"</td>"+"<td>"+e.content+"</td>"+"</tr>"}$(".diagnose-tbody").html(g);$("#view-diagnose").modal("toggle")})}});var calendarContainer=$("#calendar-container");$("#userlist tbody").on("click",".view_calendar",function(b){calendarContainer.addClass("active");$("#calendar").fullCalendar("render");var a=$(this).closest("tr").data("uid");$.get("/get_calendar_events?pid="+a,function(d){var c=[];console.log(d.eventList);$.each(d.eventList,function(e){if(!isNaN(+e)){c[e]={title:this.name,start:moment(this.happen_time).format("YYYY-MM-DD"),end:moment((this.end_time)||this.happen_time).format("YYYY-MM-DD"),className:"level"+this.level,url:"get_related_diagnose?eid="+this._id}}});console.log(c);calendar.fullCalendar("removeEvents");calendar.fullCalendar("addEventSource",c)})});calendarContainer.find(".close").click(function(){calendarContainer.removeClass("active")});var searchForm=$("#search-form");var userList=$("#userlist").find("tbody");searchForm.submit(function(a){a.preventDefault();$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:$(this).serialize()}).done(function(e){console.log(e);userList.empty();var f="";for(var d=0,b=e.userList.length;d<b;d++){var c=e.userList[d];f+=('<tr data-uid="'+c._id+'">'+"<td>"+c.account+"</td>"+"<td>"+c.role_prop.real_name+"</td>"+'<td data-sex="'+c.role_prop.sex+'">'+(c.role_prop.sex==0?"男":"女")+"</td>"+"<td>"+c.role_prop.age+"</td>"+"<td>"+((c.role_prop.address)||"未填写")+"</td>"+"<td>"+c.role_prop.tel_phone+"</td>"+"<td>"+c.role_prop.phone+"</td>"+"<td>"+'<div role="group" class="btn-group btn-group-sm">'+'<button type="button" class="btn btn-default edit_btn view_calendar">用户日历</button>'+'<button type="button" class="btn btn-default edit_btn view_info">查看资料</button>'+"</div>"+"</td>"+"</tr>")}userList.html(f)}).fail(function(b,d,c){console.log("textStatus:"+d);console.log("errorThrown:"+c)})});

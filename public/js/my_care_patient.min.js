var patientInfoDialog=$("#patient_info_dialog");$("table tbody").on("click",".view_info",function(t){var e=$(this).closest("tr");$.ajax({url:"/get_patient_info/"+e.data("uid")}).done(function(t){console.log(t);var e=t.data.patient,n=e.role_prop;patientInfoDialog.find(".modal-title").text(n.real_name+"的信息").end().find(".account").text(e.account).end().find(".role").text(e.role).end().find(".name").text(n.real_name).end().find(".sex").text("0"==n.sex?"男":"女").end().find(".age").text(n.age).end().find(".height").text(n.height).end().find(".weight").text(n.weight).end().find(".medical_case").text(n.medical_case).end().find(".id_card").text(n.id_card).end().find(".patient_number").text(5).end().find(".phone").text(n.phone).end().find(".tel_phone").text(n.tel_phone).end().find(".address").text(n.address);var a=t.data.familyList;patientInfoDialog.find(".family_table tbody").empty();for(var d=0,o=a.length;o>d;d++){var i=a[d];$("<tr><td>"+i.name+"</td><td>"+i.tel_phone+"</td><td>"+i.relationship+"</td><td>"+(1==i.is_message?"是":"否")+"</td><td>"+i.remark+"</td></tr>").appendTo(patientInfoDialog.find(".family_table tbody"))}$("#patient_info_dialog").modal("show")}).fail(function(){console.log("获取病人信息失败")})});var calendar=$("#calendar");$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},defaultDate:Date.now(),buttonIcons:!1,weekNumbers:!0,editable:!0,eventLimit:!0,events:[{title:"按紧急按钮",start:"2015-02-01T16:30:00"}],eventClick:function(t,e,n){event.preventDefault(),$.get(t.url,function(t){console.log(t);for(var e="",n=0,a=t.length;a>n;n++){var d=t[n];e+="<tr><td>"+d.create_time+"</td><td>"+d.doctor_name+"</td><td>"+d.content+"</td></tr>"}$(".diagnose-tbody").html(e),$("#view-diagnose").modal("toggle")})}});var calendarContainer=$("#calendar-container");$("#userlist tbody").on("click",".view_calendar",function(t){calendarContainer.addClass("active"),$("#calendar").fullCalendar("render");var e=$(this).closest("tr").data("uid");$.get("/get_calendar_events?pid="+e,function(t){var e=[];console.log(t.eventList),$.each(t.eventList,function(t){isNaN(+t)||(e[t]={title:this.name,start:moment(this.happen_time).format("YYYY-MM-DD"),end:moment(this.end_time||this.happen_time).format("YYYY-MM-DD"),className:"level"+this.level,url:"get_related_diagnose?eid="+this._id})}),console.log(e),calendar.fullCalendar("removeEvents"),calendar.fullCalendar("addEventSource",e)})}),calendarContainer.find(".close").click(function(){calendarContainer.removeClass("active")});var searchForm=$("#search-form"),userList=$("#userlist").find("tbody");searchForm.submit(function(t){t.preventDefault(),$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:$(this).serialize()}).done(function(t){console.log(t),userList.empty();for(var e="",n=0,a=t.userList.length;a>n;n++){var d=t.userList[n];e+='<tr data-uid="'+d._id+'"><td>'+d.account+"</td><td>"+d.role_prop.real_name+'</td><td data-sex="'+d.role_prop.sex+'">'+(0==d.role_prop.sex?"男":"女")+"</td><td>"+d.role_prop.age+"</td><td>"+(d.role_prop.address||"未填写")+"</td><td>"+d.role_prop.tel_phone+"</td><td>"+d.role_prop.phone+'</td><td><div role="group" class="btn-group btn-group-sm"><button type="button" class="btn btn-default edit_btn view_calendar">用户日历</button><button type="button" class="btn btn-default edit_btn view_info">查看资料</button></div></td></tr>'}userList.html(e)}).fail(function(t,e,n){console.log("textStatus:"+e),console.log("errorThrown:"+n)})});
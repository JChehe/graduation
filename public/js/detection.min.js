$(function(){function e(e){var t=0;return e=parseFloat(e),34>e||e>40?t=1:35>e||e>39?t=2:36>e||e>38?t=3:(36.5>=e||e>=37.5)&&(t=4),t}function t(e,t){return(Math.random()*(t-e)+e).toFixed(1)}function a(e){s.shift(),s.push(e),p.push(p.shift()),o.setOption({series:[{data:s}]}),o.setOption({xAxis:{data:p}}),e>37.5?o.setOption({series:[{markPoint:{data:[{type:"max",name:"超过正常体温"}]}}]}):36.5>e&&o.setOption({series:[{markPoint:{data:[{type:"min",name:"低于正常水平"}]}}]})}window.onload=function(){draw()};var n=$("#temp-val");n.change(function(e){var t=$(this).val();a(t)}),$("#temp-range").change(function(e){var t=$(this).val();a(t)}),$("#drawTemp").submit(function(t){t.preventDefault();var a=null,i=parseFloat(n.val());i>37.5||36.5>i?(a={"event[name]":"体温值为："+i+"℃","event[content]":"该病人体温超出正常范围，目前体温为"+i+"℃","event[level]":e(i),"event[img]":$("#temp-linechart").find("canvas")[0].toDataURL("image/png",.8).replace(/^data:image\/\w+;base64,/,""),"event[detectType]":"temperature"},$.post("/upload_event",a,function(e){"success"===e.status&&console.log("产生时间成功")})):alert("体温正常")});var i=document.getElementById("temp-linechart"),o=echarts.init(i),r={};option=null;var s=[36.6,37,37.2,37.1,37.2,37.3,37.4],p=["周一","周二","周三","周四","周五","周六","周日"];+new Date(1997,9,3),1e3*Math.random();if(option={title:{text:"体温记录（一周）"},tooltip:{trigger:"axis"},legend:{data:["体温"]},toolbox:{show:!0,feature:{dataZoom:{},dataView:{readOnly:!1},magicType:{type:["line","bar"]},restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:p},yAxis:{type:"value",axisLabel:{formatter:"{value} °C"}},series:[{name:"体温",type:"line",data:s,markLine:{data:[{type:"average",name:"平均值"}]}}]},r.timeTicket=setInterval(function(){a(t(36.5,37.5))},1e4),option&&"object"==typeof option){+new Date;o.setOption(option,!0);+new Date}});